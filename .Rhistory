"Nejvyšší osobní výsledek v celém turnaji je 417,5 HK, ale ten znamenal 'jen' 29. místo.",
"\n\n\n\nS úctou,\nFrantišek Kalvas a Pavlína Máchová")
) %>% ungroup %>% select(email, dopis) %>% filter(!is.na(email))
dopisy
View(dopisy)
## Skript na zpracování a odeslání e-mailu s oznámením odměn účastníkům turnaje PGG
## Encoding: windows-1250
## Vytvořil: 2021-04-21 FrK
## Upravil: 2021-05-12 FrK
# ## Hlavička a načtení dat -----------------------------------------------
## Smazání paměti
rm(list = ls())
## Package
library(dplyr)
library(writexl)
## Načtení dat
load("vsechnaCistaData.RData")
# ## Odměny ---------------------------------------------------------------
## Nejdřív je potřeba znovu vygenerovat vyhodnoceni:
dfv = vysledek %>% ungroup() %>% arrange(., desc(soucetSkupiny), desc(celkem)) %>%
select(email, session, soucetSkupiny, celkem) #%>%
# group_by(email) %>% mutate(x = 1) %>% mutate(x = sum(x)) %>%   # Kontrola, jestli tam není nějaký email dvakrát.
# arrange(., desc(x), email)  # OK, dopadlo to dobře, každý mail tu je jen jednou!
# vyhodnoceni
## Teď je potřeba vůbec nadefinovat vektor s odměnami a doplnit 0 na délku `vyhodnoceni`:
odmeny = c(seq(1000, 500, -100), 450, 400, 400, 350, rep(300,3), 250, rep(200, 5), 150,
150, rep(100, 6), rep(50, 16), 25, 25, rep(0, nrow(dfv) - 45))
# length((odmeny))
# sum(odmeny)
# SUPER! Sedí to!
## Tak... Teď připojím `odmeny` jako další proměnnou do `vyhodnoceni` a
# rovnou každému vypočtu jeho odměnu:
# 1) seskupím je podle `soucetSkupiny` a podle `celkem`, tím mi přirozeně vzniknou skupinky,
#    které si budou dělit odměny průměrem (při rovnosti bodů skupiny vytváří `super-skupiny`
#    a uvnitř nich si dělí odměnu rovným dílem hráči se stejným počtem bodů)
# 2) uvnitř skupin daných rovnými body (jak skupin tak hráčů) spočítám průměrné odměny
# 3) když budou body unikátní, zkrátka se replikuje hodnota, když ne, rozdělí se
# 4) využívám toho, že žebříček hráčů a jejich výsledků už je seřazený sestupně, od nejlepší skupiny
#    po nejhorší, a totéž s hráči, když k tomu pak přidám sestupně seřazené odměny, snadno to spočtu
vyhodnoceni = cbind(dfv, 'odmena' = odmeny, misto = 1:nrow(dfv)) %>% group_by(soucetSkupiny, celkem) %>%
mutate(odmena = mean(odmena),
odmena = if_else(odmena == 368.75, 370, odmena),  # Bude to stát sice 30 Kč navíc, ale zaokrouhlíme to na celé desetikoruny nahoru, přeci nebudu 24 vítězům posílat 368.75 Kč 24x...
# 5) a rovnou si tu připravím proměnné nutné pro sestavení emailu hráčům
od = min(misto),
do = max(misto),
umisteni = if_else(od == do,
paste0("na ", od, ". místě"),
paste0("na ", od, ". až ", do, ". místě")),
odmenit= if_else(odmena == 0,
". Toto umístění je, Bohu žel, bez finanční odměny.",
paste0(", za což Vám náleží odměna ", odmena, " Kč. Pošlete nám prosím číslo účtu, abychom Vám mohli odměnu zaslat.")),
email = if_else(email == "annaraichlova@s", "annaraichlova@seznam.cz", email)
)
vyhodnoceni
dopisy = vyhodnoceni %>%
mutate(
dopis =
paste0("Milá účastnice, milý účastníku turnaje PGG,\n\n\n\n",
"nejprve Vám ještě jednou srdečně děkujeme za Vaší účast v turnaji -- bez Vás by nebylo možné zkoumat ",
"lidskou kooperaci, která byla předmětem naší studie. ",
"Dále Vám v e-mailu sdělujeme Váš výsledek v turnaji a jaká odměna Vám náleží. \n\n",
"Toto je náš druhý pokus Vám poslat výsledky hromadně, první se příliš nevydařil. ",
"Pokud jste první e-mail s výsledky dostali, je tento bepředmětný -- nejsou zde nové informace, ",
"jen se ještě jednou snažíme obeslat účastníky najednou.\n\n",
"Nyní k výsledkům. Jelikož vaše skupina získala dohromady ", soucetSkupiny, " HK a Vy osobně ",
celkem, " HK, jste v celkovém pořadí ", umisteni, odmenit, "\n\n",
"Pro zajímavost, maximálního možného výsledku 1600 HK za celou skupinu dosáhlo 6 skupin a ",
"jejich členky a členové si tak rovným dílem rozdělili odměny za 1. až 24. místo ",
"(všichni shodně měli osobní výsledek 400 HK, jinak konec konců nebylo možné maxima dosáhnout). ",
"Nejvyšší osobní výsledek v celém turnaji je 417,5 HK, ale ten znamenal 'jen' 29. místo.",
"\n\n\n\nS úctou,\nFrantišek Kalvas a Pavlína Máchová")
) %>% ungroup %>% select(email, dopis) %>% filter(!is.na(email))
dopisy
library(readr)
poslat = read_xlsx("prehled.xlsx")
library(readxl)
poslat = read_xlsx("prehled.xlsx")
View(poslat)
poslat = read_csv2("prehled.csv")
poslat = read_csv2("prehled.csv") %>% select(dopisDorucen)
poslat = read_csv2("prehled.csv") %>% select(email, dopisDorucen)
poslat = read_csv2("prehled.csv") %>% select(email, dopisDorucen)
dopisy2 = left_join(dopisy, poslat)
View(dopisy2)
dopisy2 = left_join(dopisy, poslat) %>% filter(!dopisDorucen)
## Pro otestování adres ještě uložím adresy do Excelu a tam odtud to ručně nakopíruju do řádku mailu:
write_xlsx(dopisy2, "kontrolaV02.xlsx")
## Skript na zpracování a odeslání e-mailu s oznámením odměn účastníkům turnaje PGG
## Encoding: windows-1250
## Vytvořil: 2021-04-21 FrK
## Upravil: 2021-05-12 FrK
# ## Hlavička a načtení dat -----------------------------------------------
## Smazání paměti
rm(list = ls())
## Package
library(dplyr)
library(readr)
library(readxl)
library(writexl)
## Načtení dat
load("vsechnaCistaData.RData")
# ## Odměny ---------------------------------------------------------------
## Nejdřív je potřeba znovu vygenerovat vyhodnoceni:
dfv = vysledek %>% ungroup() %>% arrange(., desc(soucetSkupiny), desc(celkem)) %>%
select(email, session, soucetSkupiny, celkem) #%>%
# group_by(email) %>% mutate(x = 1) %>% mutate(x = sum(x)) %>%   # Kontrola, jestli tam není nějaký email dvakrát.
# arrange(., desc(x), email)  # OK, dopadlo to dobře, každý mail tu je jen jednou!
# vyhodnoceni
## Teď je potřeba vůbec nadefinovat vektor s odměnami a doplnit 0 na délku `vyhodnoceni`:
odmeny = c(seq(1000, 500, -100), 450, 400, 400, 350, rep(300,3), 250, rep(200, 5), 150,
150, rep(100, 6), rep(50, 16), 25, 25, rep(0, nrow(dfv) - 45))
# length((odmeny))
# sum(odmeny)
# SUPER! Sedí to!
## Tak... Teď připojím `odmeny` jako další proměnnou do `vyhodnoceni` a
# rovnou každému vypočtu jeho odměnu:
# 1) seskupím je podle `soucetSkupiny` a podle `celkem`, tím mi přirozeně vzniknou skupinky,
#    které si budou dělit odměny průměrem (při rovnosti bodů skupiny vytváří `super-skupiny`
#    a uvnitř nich si dělí odměnu rovným dílem hráči se stejným počtem bodů)
# 2) uvnitř skupin daných rovnými body (jak skupin tak hráčů) spočítám průměrné odměny
# 3) když budou body unikátní, zkrátka se replikuje hodnota, když ne, rozdělí se
# 4) využívám toho, že žebříček hráčů a jejich výsledků už je seřazený sestupně, od nejlepší skupiny
#    po nejhorší, a totéž s hráči, když k tomu pak přidám sestupně seřazené odměny, snadno to spočtu
vyhodnoceni = cbind(dfv, 'odmena' = odmeny, misto = 1:nrow(dfv)) %>% group_by(soucetSkupiny, celkem) %>%
mutate(odmena = mean(odmena),
odmena = if_else(odmena == 368.75, 370, odmena),  # Bude to stát sice 30 Kč navíc, ale zaokrouhlíme to na celé desetikoruny nahoru, přeci nebudu 24 vítězům posílat 368.75 Kč 24x...
# 5) a rovnou si tu připravím proměnné nutné pro sestavení emailu hráčům
od = min(misto),
do = max(misto),
umisteni = if_else(od == do,
paste0("na ", od, ". místě"),
paste0("na ", od, ". až ", do, ". místě")),
odmenit= if_else(odmena == 0,
". Toto umístění je, Bohu žel, bez finanční odměny.",
paste0(", za což Vám náleží odměna ", odmena, " Kč. Pošlete nám prosím číslo účtu, abychom Vám mohli odměnu zaslat.")),
email = if_else(email == "annaraichlova@s", "annaraichlova@seznam.cz", email)
)
vyhodnoceni
dopisy = vyhodnoceni %>%
mutate(
dopis =
paste0("Milá účastnice, milý účastníku turnaje PGG,\n\n\n\n",
"nejprve Vám ještě jednou srdečně děkujeme za Vaší účast v turnaji -- bez Vás by nebylo možné zkoumat ",
"lidskou kooperaci, která byla předmětem naší studie. ",
"Dále Vám v e-mailu sdělujeme Váš výsledek v turnaji a jaká odměna Vám náleží. \n\n",
"Toto je náš druhý pokus Vám poslat výsledky hromadně, první se příliš nevydařil. ",
"Pokud jste první e-mail s výsledky dostali, je tento bepředmětný -- nejsou zde nové informace, ",
"jen se ještě jednou snažíme obeslat účastníky najednou.\n\n",
"Nyní k výsledkům. Jelikož vaše skupina získala dohromady ", soucetSkupiny, " HK a Vy osobně ",
celkem, " HK, jste v celkovém pořadí ", umisteni, odmenit, "\n\n",
"Pro zajímavost, maximálního možného výsledku 1600 HK za celou skupinu dosáhlo 6 skupin a ",
"jejich členky a členové si tak rovným dílem rozdělili odměny za 1. až 24. místo ",
"(všichni shodně měli osobní výsledek 400 HK, jinak konec konců nebylo možné maxima dosáhnout). ",
"Nejvyšší osobní výsledek v celém turnaji je 417,5 HK, ale ten znamenal 'jen' 29. místo.",
"\n\n\n\nS úctou,\nFrantišek Kalvas a Pavlína Máchová")
) %>% ungroup %>% select(email, dopis) %>% filter(!is.na(email))
dopisy
poslat = read_csv2("prehled.csv") %>% select(email, dopisDorucen)
dopisy2 = left_join(dopisy, poslat) %>% filter(!dopisDorucen)
# ## Odeslání personalizovaných výsledků: ---------------------------------
library(emayili)
library(dplyr)
library(magrittr)
for (d in 1:nrow(dopisy2)) {
email <- envelope() %>%
from("kalvas@kss.zcu.cz") %>%
to(dopisy2$email[d]) %>%
subject(qp_encode("Vyhodnocení turnaje PGG (21.4.2021--2.5.2021): Druhý pokus o hromadné odeslání")) %>%
text(qp_encode(dopisy2$dopis[d]))
# print(email, details = T)
smtp <- server(host = "smtp.zcu.cz",
port = 465,
username = "kalvas",
password = "Dingo933")
smtp(email, verbose = TRUE)
}
vyhodnoceni
write_xlsx(vyhodnoceni %>% select(email, odmena), "odmeny.xlsx")
write_xlsx(vyhodnoceni %>% ungroup() %>% select(email, odmena), "odmeny.xlsx")
poslano = read_csv2("prehled.csv") %>% select(email, dopisDorucen)
library(dplyr)
library(readr)
poslano = read_csv2("prehled.csv") %>% select(email, dopisDorucen)
View(poslano)
poslano = read_csv2("prehled.csv")
View(poslano)
poslano = read_csv2("prehled.csv")
View(poslano)
Sys.Date()
Sys.Date() %>% class()
as.Date(poslano$kdyPoslano)
poslano = read_csv2("prehled.csv")
poslano = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano)
poslano = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date())
poslano = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas"
))
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
poslano = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
## Samotné odeslání
library(emayili)
library(dplyr)
library(magrittr)
for (d in 1:nrow(dopisy3)) {
email <- envelope() %>%
from("kalvas@kss.zcu.cz") %>%
to(dopisy3$email[d]) %>%
subject(qp_encode("Peníze z turnaje PGG Vám byly dnes odeslány")) %>%
text(qp_encode(dopisy3$dopis[d]))
# print(email, details = T)
smtp <- server(host = "smtp.zcu.cz",
port = 465,
username = "login",
password = "pass")
smtp(email, verbose = TRUE)
}
## Konstrukce zprávy
library(dplyr)
library(readr)
dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
## Samotné odeslání
library(emayili)
library(dplyr)
library(magrittr)
for (d in 1:nrow(dopisy3)) {
email <- envelope() %>%
from("kalvas@kss.zcu.cz") %>%
to(dopisy3$email[d]) %>%
subject(qp_encode("Peníze z turnaje PGG Vám byly dnes odeslány")) %>%
text(qp_encode(dopisy3$dopis[d]))
# print(email, details = T)
smtp <- server(host = "smtp.zcu.cz",
port = 465,
username = "kalvas",
password = "Dingo933")
smtp(email, verbose = TRUE)
}
dopisy3 = read_csv2("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
library(readxl)
dopisy3 = read_csv2("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
dopisy3 = read_xlsx("prehled.xlsx")
View(dopisy3)
dopisy3 = read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
dopisy3
View(dopisy3)
dopisy3 = read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
## Konstrukce zprávy
library(dplyr)
library(readr)
library(readxl)
dopisy3 = read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
View(dopisy3)
## Konstrukce zprávy
library(dplyr)
library(readr)
library(readxl)
dopisy3 = read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
dopisy3 = read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
dopisy3 = read_xlsx("prehled.xlsx")
dopisy3 = read_xlsx("prehled.xlsx")
dopisy3 = read_xlsx("prehled.xls")
dopisy3 = read_csv("prehled.csv")
View(dopisy3)
dopisy3 = read_csv2("prehled.csv")
dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
View(dopisy3)
dopisy3 = read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
#dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
dopisy3 = read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
#dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
dopisy3 = read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
#dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
library(readxl)
dopisy3 = readxl::read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
#dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
readxl::read_xlsx("prehled.xlsx")
readxl::read_excel("prehled.xlsx")
#dopisy3 = readxl::read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
## Konstrukce zprávy
library(dplyr)
library(readr)
library(readxl)
#dopisy3 = readxl::read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
View(dopisy3)
## Samotné odeslání
library(emayili)
library(dplyr)
library(magrittr)
for (d in 1:nrow(dopisy3)) {
email <- envelope() %>%
from("kalvas@kss.zcu.cz") %>%
to(dopisy3$email[d]) %>%
subject(qp_encode("Peníze z turnaje PGG Vám byly dnes odeslány")) %>%
text(qp_encode(dopisy3$dopis[d]))
# print(email, details = T)
smtp <- server(host = "smtp.zcu.cz",
port = 465,
username = "login",
password = "pass")
smtp(email, verbose = TRUE)
}
for (d in 1:nrow(dopisy3)) {
email <- envelope() %>%
from("kalvas@kss.zcu.cz") %>%
to(dopisy3$email[d]) %>%
subject(qp_encode("Peníze z turnaje PGG Vám byly dnes odeslány")) %>%
text(qp_encode(dopisy3$dopis[d]))
# print(email, details = T)
smtp <- server(host = "smtp.zcu.cz",
port = 465,
username = "kalvas",
password = "Dingo933")
smtp(email, verbose = TRUE)
}
dopisy3 = readxl::read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
# dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
## Konstrukce zprávy
library(dplyr)
library(readr)
library(readxl)
dopisy3 = readxl::read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
# dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
dopisy3 = readxl::read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
# dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
dopisy3 = readxl::read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano)
View(dopisy3)
dopisy3 = readxl::read_xlsx("prehled.xlsx") %>% select(email, ucet, castka, kdyPoslano) %>%
# dopisy3 = read_csv2("prehled.csv") %>% select(email, ucet, castka, kdyPoslano) %>%
filter(kdyPoslano != "---") %>%
mutate(dnes = as.Date(kdyPoslano) == Sys.Date(),
dopis =
paste0(
"Vážená účastnice, vážený účastníku turnaje PGG, \n\n\n",
"dnes (", kdyPoslano, ") jsem Vám odeslal odměnu ", castka, " Kč na Váš účet číslo ",
ucet, ". Ještě jednou -- a naposled -- Vám děkuji za účast v našem projektu a snad ",
"se setkáme v jiném projektu někdy v budoucnu. \n\n\nS úctou,\nFrantišek Kalvas")) %>%
filter(dnes)
View(dopisy3)
